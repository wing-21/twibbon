<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=0.70;" />
    <title>Twibbon App</title>
    <meta property="og:title" content="Twibbon App" />
    <meta property="og:image" content="https://pui-real.pages.dev/img/og.png" />
    <meta property="og:description" content="Ini adalah situs web tempat Anda dapat menambahkan foto ke bingkai." />
    <meta name="msapplication-TileColor" content="#af0a1a" />
    <meta name="theme-color" content="#ffffff" />
    <link rel="shortcut icon" href="img/fav-16.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="img/fav-32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="img/fav-16.png" />
    <link rel="apple-touch-icon" href="img/fav-57.png" />
    <link rel="apple-touch-icon" sizes="114x114" href="img/fav-114.png" />
    <link rel="apple-touch-icon" sizes="72x72" href="img/fav-72.png" />
    <link rel="apple-touch-icon" sizes="144x144" href="img/fav-144.png" />
    <link rel="manifest" href="pwa-manifest.json" />
    <link rel="stylesheet" href="css/style.css" />

    <style type="text/css">
      button,
      label,
      canvas,
      div {
        box-sizing: border-box;
      }

      #input-file {
        position: absolute;
        left: -10000px;
      }

      #preview {
        border: 1px solid #eee;
        margin: 10px 0;
        background: #eee;
        width: 100%;
      }

      .wrapper {
        width: 100%;
        padding: 10px;
        max-width: 360px;
        min-width: 240px;
        margin: 0 auto;
      }

      .action {
        font-size: 13px;
        text-decoration: none;
        cursor: pointer;
        color: #669ada;
        padding: 10px 20px;
        border-radius: 50px;
        border: 1px solid;
        display: block;
        text-align: center;
      }

      .action[href=''] {
        display: none;
      }
    </style>
    <script type="text/javascript" src="js/main.js"></script>
  </head>
  <body>
    <article>
      <h1>TWIBBON GENERATOR</h1>

      <p>Ini adalah situs web tempat Anda dapat menambahkan foto ke bingkai.</p>

      <div class="wrapper">
        <canvas id="preview" width="500" height="500" title="Preview"></canvas><br />
        <label class="action">
          <input type="file" id="input-file" accept="image/*" />
          Pilih Gambar
        </label>
        <a download="twibbon-by-ferryayunda.png" class="action" id="download-link" href="">Simpan Twibbon</a>
        <img src="./assets/placeholder.png" alt="" width="1" id="placeholder" hidden />
      </div>

      <p>Fitur: Tidak perlu keterampilan pengeditan tambahan. Dibutuhkan kurang dari dua menit untuk melakukannya dan bebas biaya. Ini sudah tersedia, ramah pengguna dan tersedia untuk semua.</p>

      <script type="text/javascript">
        const input = document.getElementById('input-file');
        const canvas = document.getElementById('preview');
        const context = canvas.getContext('2d');
        const ph = document.getElementById('placeholder');
        const dlLink = document.getElementById('download-link');
        const twibbon = new Image();
        let img = new Image();
        let imgX = 0,
          imgY = 0,
          imgScale = 1;
        let isDragging = false,
          startX,
          startY;

        twibbon.src = './assets/twibbon.png';
        dlLink.hidden = true;

        twibbon.onload = function () {
          drawCanvas();
        };

        input.addEventListener('change', function () {
          const file = input.files[0];
          if (file) {
            img.src = URL.createObjectURL(file);
          }
        });

        img.onload = function () {
          imgX = 0;
          imgY = 0;
          imgScale = 1;
          drawCanvas();
          dlLink.hidden = false;
          prepareDownloadLink();
        };

        canvas.addEventListener('mousedown', function (e) {
          isDragging = true;
          startX = e.offsetX - imgX;
          startY = e.offsetY - imgY;
        });

        canvas.addEventListener('mousemove', function (e) {
          if (isDragging) {
            imgX = e.offsetX - startX;
            imgY = e.offsetY - startY;
            drawCanvas();
            prepareDownloadLink();
          }
        });

        canvas.addEventListener('mouseup', function () {
          isDragging = false;
        });

        // Touch events for mobile devices
        canvas.addEventListener('touchstart', function (e) {
          if (e.touches.length === 1) {
            const touch = e.touches[0];
            isDragging = true;
            startX = touch.clientX - imgX;
            startY = touch.clientY - imgY;
          }
        });

        canvas.addEventListener('touchmove', function (e) {
          if (isDragging && e.touches.length === 1) {
            const touch = e.touches[0];
            imgX = touch.clientX - startX;
            imgY = touch.clientY - startY;
            drawCanvas();
            prepareDownloadLink();
          }
        });

        canvas.addEventListener('touchend', function () {
          isDragging = false;
        });

        canvas.addEventListener('wheel', function (e) {
          e.preventDefault();
          const scaleAmount = e.deltaY > 0 ? 0.9 : 1.1;
          imgScale *= scaleAmount;
          drawCanvas();
          prepareDownloadLink();
        });

        // Pinch to zoom for mobile devices
        let initialDistance = null;
        canvas.addEventListener('touchmove', function (e) {
          if (e.touches.length === 2) {
            const touch1 = e.touches[0];
            const touch2 = e.touches[1];
            const currentDistance = Math.hypot(touch1.clientX - touch2.clientX, touch1.clientY - touch2.clientY);

            if (initialDistance === null) {
              initialDistance = currentDistance;
            } else {
              const scaleAmount = currentDistance / initialDistance;
              imgScale *= scaleAmount;
              initialDistance = currentDistance;
              drawCanvas();
              prepareDownloadLink();
            }
          }
        });

        canvas.addEventListener('touchend', function (e) {
          if (e.touches.length < 2) {
            initialDistance = null;
          }
        });

        function drawCanvas() {
          context.clearRect(0, 0, 500, 500);
          context.drawImage(img, imgX, imgY, img.width * imgScale, img.height * imgScale);
          context.drawImage(twibbon, 0, 0, 500, 500);
        }

        function prepareDownloadLink() {
          dlLink.setAttribute('download', input.files[0].name.replace(/\.\w+$/, '-framed.png'));
          dlLink.href = canvas.toDataURL();
        }
      </script>
    </article>
    <footer>
      <p><a target="_blank" rel="noopener" href="https://www.webmeid.com">Copyright Â© 2024 Webmeid.</a></p>
    </footer>
  </body>
</html>
