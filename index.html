<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=0.70;" />
    <title>Twibbon App</title>
    <meta property="og:title" content="Twibbon App" />
    <meta property="og:image" content="https://pui-real.pages.dev/img/og.png" />
    <meta property="og:description" content="Ini adalah situs web tempat Anda dapat menambahkan foto ke bingkai." />
    <meta name="msapplication-TileColor" content="#af0a1a" />
    <meta name="theme-color" content="#ffffff" />
    <link rel="shortcut icon" href="img/fav-16.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="img/fav-32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="img/fav-16.png" />
    <link rel="apple-touch-icon" href="img/fav-57.png" />
    <link rel="apple-touch-icon" sizes="114x114" href="img/fav-114.png" />
    <link rel="apple-touch-icon" sizes="72x72" href="img/fav-72.png" />
    <link rel="apple-touch-icon" sizes="144x144" href="img/fav-144.png" />
    <link rel="manifest" href="pwa-manifest.json" />
    <link rel="stylesheet" href="css/style.css" />

    <style type="text/css">
      button,
      label,
      canvas,
      div {
        box-sizing: border-box;
      }

      #input-file {
        position: absolute;
        left: -10000px;
      }

      #preview {
        border: 1px solid #eee;
        margin: 10px 0;
        background: #eee;
        width: 100%;
        max-width: 500px;
        height: auto;
      }

      .wrapper {
        width: 100%;
        padding: 10px;
        max-width: 360px;
        min-width: 240px;
        margin: 0 auto;
      }

      .action {
        font-size: 13px;
        text-decoration: none;
        cursor: pointer;
        color: #669ada;
        padding: 10px 20px;
        border-radius: 50px;
        border: 1px solid;
        display: block;
        text-align: center;
      }

      .action[href=''] {
        display: none;
      }

      .control-buttons {
        display: flex;
        justify-content: space-between;
        width: 200px;
        margin: 10px auto;
      }

      .control-buttons button {
        padding: 10px;
        font-size: 16px;
      }
    </style>
    <script type="text/javascript" src="js/main.js"></script>
  </head>
  <body>
    <article>
      <h1>PKKMB FKEP 2024</h1>

      <p>Ini adalah situs web generate twibbon PKKMB FKEP UNHAS 2024</p>

      <div class="wrapper">
        <canvas id="preview" width="500" height="500" title="Preview"></canvas><br />
        <label class="action">
          <input type="file" id="input-file" accept="image/*" />
          Pilih Gambar
        </label>
        <div class="control-buttons">
          <button id="up">⬆️</button>
          <button id="left">⬅️</button>
          <button id="down">⬇️</button>
          <button id="right">➡️</button>
        </div>
        <a download="twibbon-by-ferryayunda.png" class="action" id="download-link" href="">Simpan Twibbon</a>
        <img src="./assets/placeholder.png" alt="" width="1" id="placeholder" hidden />
      </div>

      <p>Ket : Sesuaiakan posisi foto dengan mengklik tombol panah</p>

      <script type="text/javascript">
        const input = document.getElementById('input-file');
        const canvas = document.getElementById('preview');
        const context = canvas.getContext('2d');
        const ph = document.getElementById('placeholder');
        const dlLink = document.getElementById('download-link');
        const twibbon = new Image();
        let img = new Image();
        let imgX = 0,
          imgY = 0,
          imgScale = 1;
        let imgWidth = 0,
          imgHeight = 0;
        const moveAmount = 10;

        twibbon.src = './assets/twibbon.png';
        dlLink.hidden = true;

        twibbon.onload = function () {
          drawCanvas();
        };

        input.addEventListener('change', function () {
          const file = input.files[0];
          if (file) {
            img.src = URL.createObjectURL(file);
          }
        });

        img.onload = function () {
          imgX = 0;
          imgY = 0;
          imgScale = 1;
          adjustImageSize();
          drawCanvas();
          dlLink.hidden = false;
          prepareDownloadLink();
        };

        function adjustImageSize() {
          const aspectRatio = img.width / img.height;
          if (img.width > img.height) {
            imgWidth = 500;
            imgHeight = 500 / aspectRatio;
          } else {
            imgHeight = 500;
            imgWidth = 500 * aspectRatio;
          }
        }

        function drawCanvas() {
          context.clearRect(0, 0, 500, 500);
          context.drawImage(img, imgX, imgY, imgWidth * imgScale, imgHeight * imgScale);
          context.drawImage(twibbon, 0, 0, 500, 500);
        }

        function prepareDownloadLink() {
          canvas.toBlob(function (blob) {
            const url = URL.createObjectURL(blob);
            dlLink.href = url;
            dlLink.download = input.files[0].name.replace(/\.\w+$/, '-framed.png');
          });
        }

        document.getElementById('up').addEventListener('click', function () {
          imgY -= moveAmount;
          drawCanvas();
          prepareDownloadLink();
        });

        document.getElementById('down').addEventListener('click', function () {
          imgY += moveAmount;
          drawCanvas();
          prepareDownloadLink();
        });

        document.getElementById('left').addEventListener('click', function () {
          imgX -= moveAmount;
          drawCanvas();
          prepareDownloadLink();
        });

        document.getElementById('right').addEventListener('click', function () {
          imgX += moveAmount;
          drawCanvas();
          prepareDownloadLink();
        });

        // Prevent zoom on double tap
        let lastTouchEnd = 0;
        document.addEventListener(
          'touchend',
          function (event) {
            const now = new Date().getTime();
            if (now - lastTouchEnd <= 300) {
              event.preventDefault();
            }
            lastTouchEnd = now;
          },
          false
        );

        // Prevent image zoom on mobile
        document.addEventListener(
          'touchmove',
          function (event) {
            if (event.scale !== 1) {
              event.preventDefault();
            }
          },
          { passive: false }
        );
      </script>
    </article>
    <footer>
      <p><a target="_blank" rel="noopener" href="https://www.webmeid.com">Copyright © 2024 Webmeid.</a></p>
    </footer>
  </body>
</html>
